<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Musical Drums - Sarah & Finn's Twin Games</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
            }
            to {
                transform: translateY(0);
            }
        }

        h1 {
            color: #764ba2;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            flex-wrap: wrap;
            animation: fadeIn 0.8s ease-out 0.3s both;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .control-group {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Comic Sans MS', cursive;
            margin: 5px;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        button:active {
            transform: scale(0.95);
        }

        button.active {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        select {
            padding: 10px;
            border-radius: 10px;
            border: 2px solid #667eea;
            font-family: 'Comic Sans MS', cursive;
            font-size: 16px;
            background: white;
            cursor: pointer;
            margin: 0 5px;
        }

        .drum-stage {
            position: relative;
            width: 100%;
            max-width: 900px;
            height: 500px;
            margin: 20px auto;
            background: radial-gradient(ellipse at center, rgba(255, 255, 255, 0.1), transparent);
            animation: stageAppear 1s ease-out 0.5s both;
        }

        @keyframes stageAppear {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .drum {
            position: absolute;
            cursor: pointer;
            transition: all 0.1s ease;
            user-select: none;
        }

        .drum:hover {
            transform: scale(1.05);
        }

        .drum.active {
            animation: drumHit 0.2s ease;
        }

        @keyframes drumHit {
            0% {
                transform: scale(1) rotate(0deg);
            }
            50% {
                transform: scale(1.2) rotate(-3deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
            }
        }

        /* Kick Drum */
        .kick-drum {
            width: 180px;
            height: 180px;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: radial-gradient(circle at 30% 30%, #8b4513, #4a2409);
            border-radius: 50%;
            border: 8px solid #2d1810;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3), inset 0 0 30px rgba(0, 0, 0, 0.3);
        }

        .kick-drum::before {
            content: 'KICK';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.8);
            font-weight: bold;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .kick-drum::after {
            content: '[SPACE]';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* Snare Drum */
        .snare-drum {
            width: 140px;
            height: 80px;
            bottom: 180px;
            left: 30%;
            background: linear-gradient(180deg, #e0e0e0, #c0c0c0);
            border-radius: 50% / 30%;
            border: 6px solid #808080;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3), inset 0 -5px 10px rgba(0, 0, 0, 0.2);
        }

        .snare-drum::before {
            content: 'SNARE';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #333;
            font-weight: bold;
            font-size: 20px;
        }

        .snare-drum::after {
            content: '[S]';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* Hi-Hat */
        .hi-hat {
            width: 100px;
            height: 100px;
            bottom: 200px;
            left: 10%;
            background: radial-gradient(circle at center, #ffd700, #b8860b);
            border-radius: 50%;
            border: 4px solid #8b6914;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3), inset 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .hi-hat::before {
            content: 'HI-HAT';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #333;
            font-weight: bold;
            font-size: 16px;
        }

        .hi-hat::after {
            content: '[H]';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* Crash Cymbal */
        .crash {
            width: 120px;
            height: 120px;
            bottom: 250px;
            right: 10%;
            background: radial-gradient(ellipse at center, #ffd700, #cdaa3d);
            border-radius: 50%;
            border: 3px solid #8b6914;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3), inset 0 0 20px rgba(255, 255, 255, 0.6);
            transform: perspective(100px) rotateX(20deg);
        }

        .crash::before {
            content: 'CRASH';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #333;
            font-weight: bold;
            font-size: 18px;
        }

        .crash::after {
            content: '[C]';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* Tom Drums */
        .tom1 {
            width: 110px;
            height: 90px;
            bottom: 280px;
            left: 45%;
            background: linear-gradient(180deg, #d2691e, #8b4513);
            border-radius: 50% / 40%;
            border: 5px solid #5d2f0b;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3), inset 0 -5px 15px rgba(0, 0, 0, 0.3);
        }

        .tom1::before {
            content: 'TOM 1';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 16px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .tom1::after {
            content: '[T]';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 8px;
            border-radius: 10px;
        }

        .tom2 {
            width: 120px;
            height: 100px;
            bottom: 180px;
            right: 25%;
            background: linear-gradient(180deg, #cd853f, #8b4513);
            border-radius: 50% / 40%;
            border: 5px solid #5d2f0b;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3), inset 0 -5px 15px rgba(0, 0, 0, 0.3);
        }

        .tom2::before {
            content: 'TOM 2';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 16px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .tom2::after {
            content: '[Y]';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* Ride Cymbal */
        .ride {
            width: 110px;
            height: 110px;
            bottom: 320px;
            right: 25%;
            background: radial-gradient(ellipse at center, #ffd700, #daa520);
            border-radius: 50%;
            border: 3px solid #8b6914;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3), inset 0 0 15px rgba(255, 255, 255, 0.5);
            transform: perspective(100px) rotateX(15deg);
        }

        .ride::before {
            content: 'RIDE';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #333;
            font-weight: bold;
            font-size: 16px;
        }

        .ride::after {
            content: '[R]';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* Floor Tom */
        .floor-tom {
            width: 150px;
            height: 120px;
            bottom: 60px;
            right: 15%;
            background: linear-gradient(180deg, #8b4513, #5d2f0b);
            border-radius: 50% / 40%;
            border: 6px solid #3a1f08;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4), inset 0 -5px 20px rgba(0, 0, 0, 0.4);
        }

        .floor-tom::before {
            content: 'FLOOR';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.9);
            font-weight: bold;
            font-size: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .floor-tom::after {
            content: '[F]';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 8px;
            border-radius: 10px;
        }

        .visualizer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 2px;
            pointer-events: none;
        }

        .visualizer-bar {
            width: 4px;
            background: linear-gradient(to top, #ff6ec7, #c77dff);
            transition: height 0.1s ease;
            border-radius: 2px 2px 0 0;
        }

        .recording-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff4444;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            display: none;
            align-items: center;
            gap: 10px;
            animation: recordPulse 1s infinite;
        }

        @keyframes recordPulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        .recording-indicator.active {
            display: flex;
        }

        .recording-dot {
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0;
            }
        }

        .tempo-display {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 15px;
        }

        .tempo-display input[type="range"] {
            width: 100px;
        }

        .metronome-light {
            width: 20px;
            height: 20px;
            background: #ddd;
            border-radius: 50%;
            transition: all 0.1s ease;
        }

        .metronome-light.active {
            background: #ff6ec7;
            box-shadow: 0 0 10px #ff6ec7;
        }

        .volume-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            max-width: 600px;
            margin: 0 auto;
        }

        .volume-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .volume-control label {
            font-size: 12px;
            font-weight: bold;
            color: #667eea;
        }

        .volume-control input[type="range"] {
            width: 80px;
            height: 5px;
            -webkit-appearance: none;
            appearance: none;
            background: #ddd;
            border-radius: 5px;
            outline: none;
        }

        .volume-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            background: #667eea;
            border-radius: 50%;
            cursor: pointer;
        }

        .volume-control input[type="range"]::-moz-range-thumb {
            width: 15px;
            height: 15px;
            background: #667eea;
            border-radius: 50%;
            cursor: pointer;
        }

        .drumstick {
            position: absolute;
            width: 4px;
            height: 100px;
            background: linear-gradient(to bottom, #8b6914, #d4a574);
            border-radius: 2px;
            transform-origin: bottom center;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .drumstick::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -8px;
            width: 20px;
            height: 30px;
            background: radial-gradient(ellipse at center, #d4a574, #8b6914);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
        }

        .drumstick.left {
            left: 45%;
            transform: rotate(-20deg);
        }

        .drumstick.right {
            right: 45%;
            transform: rotate(20deg);
        }

        .drumstick.hitting {
            animation: stickHit 0.2s ease;
            opacity: 1;
        }

        @keyframes stickHit {
            0% {
                transform: rotate(-20deg) translateY(0);
            }
            50% {
                transform: rotate(5deg) translateY(20px);
            }
            100% {
                transform: rotate(-20deg) translateY(0);
            }
        }

        .pattern-display {
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 15px;
            text-align: center;
        }

        .pattern-beats {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .beat-indicator {
            width: 30px;
            height: 30px;
            background: #ddd;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .beat-indicator.active {
            background: #ff6ec7;
            color: white;
            transform: scale(1.2);
        }

        .beat-indicator.current {
            background: #667eea;
            color: white;
            animation: beatPulse 0.3s ease;
        }

        @keyframes beatPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.3);
            }
        }

        @media (max-width: 768px) {
            .drum-stage {
                height: 400px;
            }

            .drum {
                transform: scale(0.8);
            }

            .controls {
                padding: 10px;
                gap: 10px;
            }

            h1 {
                font-size: 2em;
            }

            button {
                padding: 8px 15px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .drum-stage {
                height: 350px;
            }

            .drum {
                transform: scale(0.7);
            }

            .volume-controls {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü•Å Musical Drums üéµ</h1>
    </div>

    <div class="controls">
        <div class="control-group">
            <label>Drum Kit: </label>
            <select id="kitSelect">
                <option value="acoustic">Acoustic</option>
                <option value="electronic">Electronic</option>
                <option value="world">World Percussion</option>
            </select>
        </div>

        <div class="control-group">
            <button id="recordBtn">üî¥ Record</button>
            <button id="playbackBtn" disabled>‚ñ∂Ô∏è Play Recording</button>
            <button id="clearBtn">üóëÔ∏è Clear</button>
        </div>

        <div class="control-group pattern-display">
            <label>Pattern: </label>
            <select id="patternSelect">
                <option value="none">None</option>
                <option value="rock">Rock Beat</option>
                <option value="jazz">Jazz Swing</option>
                <option value="latin">Latin Rhythm</option>
                <option value="funk">Funk Groove</option>
            </select>
            <button id="playPatternBtn">‚ñ∂Ô∏è Play Pattern</button>
            <div class="pattern-beats" id="patternBeats"></div>
        </div>

        <div class="control-group tempo-display">
            <label>Tempo: </label>
            <input type="range" id="tempoSlider" min="60" max="180" value="120">
            <span id="tempoValue">120 BPM</span>
            <div class="metronome-light" id="metronomeLight"></div>
        </div>
    </div>

    <div class="volume-controls">
        <div class="volume-control">
            <label>Kick</label>
            <input type="range" class="drum-volume" data-drum="kick" min="0" max="100" value="80">
        </div>
        <div class="volume-control">
            <label>Snare</label>
            <input type="range" class="drum-volume" data-drum="snare" min="0" max="100" value="80">
        </div>
        <div class="volume-control">
            <label>Hi-Hat</label>
            <input type="range" class="drum-volume" data-drum="hihat" min="0" max="100" value="70">
        </div>
        <div class="volume-control">
            <label>Crash</label>
            <input type="range" class="drum-volume" data-drum="crash" min="0" max="100" value="75">
        </div>
        <div class="volume-control">
            <label>Tom 1</label>
            <input type="range" class="drum-volume" data-drum="tom1" min="0" max="100" value="75">
        </div>
        <div class="volume-control">
            <label>Tom 2</label>
            <input type="range" class="drum-volume" data-drum="tom2" min="0" max="100" value="75">
        </div>
        <div class="volume-control">
            <label>Ride</label>
            <input type="range" class="drum-volume" data-drum="ride" min="0" max="100" value="70">
        </div>
        <div class="volume-control">
            <label>Floor</label>
            <input type="range" class="drum-volume" data-drum="floor" min="0" max="100" value="80">
        </div>
    </div>

    <div class="drum-stage" id="drumStage">
        <div class="drumstick left" id="leftStick"></div>
        <div class="drumstick right" id="rightStick"></div>
        
        <div class="drum kick-drum" data-drum="kick"></div>
        <div class="drum snare-drum" data-drum="snare"></div>
        <div class="drum hi-hat" data-drum="hihat"></div>
        <div class="drum crash" data-drum="crash"></div>
        <div class="drum tom1" data-drum="tom1"></div>
        <div class="drum tom2" data-drum="tom2"></div>
        <div class="drum ride" data-drum="ride"></div>
        <div class="drum floor-tom" data-drum="floor"></div>
        
        <div class="visualizer" id="visualizer"></div>
    </div>

    <div class="recording-indicator" id="recordingIndicator">
        <div class="recording-dot"></div>
        Recording...
    </div>

    <script>
        // Audio Context and initialization
        let audioContext;
        let isInitialized = false;

        // Drum volumes
        const drumVolumes = {
            kick: 0.8,
            snare: 0.8,
            hihat: 0.7,
            crash: 0.75,
            tom1: 0.75,
            tom2: 0.75,
            ride: 0.7,
            floor: 0.8
        };

        // Recording state
        let isRecording = false;
        let recordedBeats = [];
        let recordingStartTime = 0;
        let playbackTimeout;

        // Pattern playback
        let isPlayingPattern = false;
        let patternInterval;
        let currentPatternBeat = 0;

        // Tempo and metronome
        let tempo = 120;
        let metronomeInterval;

        // Drum kit configurations
        const drumKits = {
            acoustic: {
                kick: { freq: 60, decay: 0.5, tone: 0.5, pitch: 1 },
                snare: { freq: 200, decay: 0.15, noise: 0.8, tone: 0.3, pitch: 1 },
                hihat: { freq: 8000, decay: 0.05, noise: 1, tone: 0, pitch: 1 },
                crash: { freq: 5000, decay: 2, noise: 1, tone: 0.1, pitch: 1 },
                tom1: { freq: 120, decay: 0.3, tone: 0.7, pitch: 1 },
                tom2: { freq: 100, decay: 0.35, tone: 0.7, pitch: 1 },
                ride: { freq: 6000, decay: 1, noise: 0.8, tone: 0.2, pitch: 1 },
                floor: { freq: 80, decay: 0.4, tone: 0.8, pitch: 1 }
            },
            electronic: {
                kick: { freq: 50, decay: 0.8, tone: 0.9, pitch: 0.8 },
                snare: { freq: 250, decay: 0.2, noise: 0.5, tone: 0.5, pitch: 1.2 },
                hihat: { freq: 10000, decay: 0.03, noise: 0.9, tone: 0.1, pitch: 1.5 },
                crash: { freq: 4000, decay: 1.5, noise: 0.9, tone: 0.2, pitch: 0.9 },
                tom1: { freq: 150, decay: 0.25, tone: 0.9, pitch: 1.1 },
                tom2: { freq: 130, decay: 0.3, tone: 0.9, pitch: 0.95 },
                ride: { freq: 7000, decay: 0.8, noise: 0.7, tone: 0.3, pitch: 1.2 },
                floor: { freq: 70, decay: 0.5, tone: 0.95, pitch: 0.85 }
            },
            world: {
                kick: { freq: 70, decay: 0.6, tone: 0.6, pitch: 1.1 },
                snare: { freq: 300, decay: 0.1, noise: 0.4, tone: 0.6, pitch: 1.3 },
                hihat: { freq: 6000, decay: 0.08, noise: 0.7, tone: 0.3, pitch: 1.4 },
                crash: { freq: 3500, decay: 2.5, noise: 0.8, tone: 0.2, pitch: 1.1 },
                tom1: { freq: 180, decay: 0.4, tone: 0.8, pitch: 1.2 },
                tom2: { freq: 140, decay: 0.45, tone: 0.8, pitch: 1.05 },
                ride: { freq: 5500, decay: 1.2, noise: 0.6, tone: 0.4, pitch: 1.3 },
                floor: { freq: 90, decay: 0.5, tone: 0.85, pitch: 0.9 }
            }
        };

        let currentKit = 'acoustic';

        // Rhythm patterns
        const patterns = {
            rock: {
                name: 'Rock Beat',
                tempo: 120,
                beats: [
                    ['kick', 'hihat'],
                    ['hihat'],
                    ['snare', 'hihat'],
                    ['hihat'],
                    ['kick', 'hihat'],
                    ['kick', 'hihat'],
                    ['snare', 'hihat'],
                    ['hihat']
                ]
            },
            jazz: {
                name: 'Jazz Swing',
                tempo: 140,
                beats: [
                    ['ride'],
                    ['ride', 'hihat'],
                    ['ride'],
                    ['kick', 'ride'],
                    ['ride'],
                    ['ride', 'snare'],
                    ['ride'],
                    ['ride']
                ]
            },
            latin: {
                name: 'Latin Rhythm',
                tempo: 130,
                beats: [
                    ['kick', 'hihat'],
                    ['hihat'],
                    ['tom1'],
                    ['kick', 'hihat'],
                    ['hihat'],
                    ['tom2'],
                    ['snare'],
                    ['hihat']
                ]
            },
            funk: {
                name: 'Funk Groove',
                tempo: 110,
                beats: [
                    ['kick', 'hihat'],
                    ['hihat'],
                    ['snare', 'hihat'],
                    ['hihat'],
                    ['kick'],
                    ['kick', 'hihat'],
                    ['snare'],
                    ['hihat', 'snare']
                ]
            }
        };

        // Initialize audio context
        function initAudio() {
            if (!isInitialized) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                isInitialized = true;
                createVisualizer();
            }
        }

        // Create visualizer bars
        function createVisualizer() {
            const visualizer = document.getElementById('visualizer');
            for (let i = 0; i < 30; i++) {
                const bar = document.createElement('div');
                bar.className = 'visualizer-bar';
                bar.style.height = '5px';
                visualizer.appendChild(bar);
            }
        }

        // Animate visualizer
        function animateVisualizer(intensity = 0.5) {
            const bars = document.querySelectorAll('.visualizer-bar');
            bars.forEach(bar => {
                const height = Math.random() * 50 * intensity + 10;
                bar.style.height = height + 'px';
                setTimeout(() => {
                    bar.style.height = '5px';
                }, 200);
            });
        }

        // Play drum sound using Web Audio API
        function playDrumSound(drumType) {
            if (!audioContext) return;

            const now = audioContext.currentTime;
            const drumConfig = drumKits[currentKit][drumType];
            const volume = drumVolumes[drumType];

            // Create oscillator for tonal component
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            // Create noise for drums like snare and cymbals
            let noiseNode, noiseGain;
            if (drumConfig.noise) {
                const bufferSize = audioContext.sampleRate * 0.2;
                const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = (Math.random() - 0.5) * 2;
                }

                noiseNode = audioContext.createBufferSource();
                noiseNode.buffer = buffer;
                noiseGain = audioContext.createGain();
                noiseNode.connect(noiseGain);
                noiseGain.connect(audioContext.destination);
            }

            // Configure oscillator
            oscillator.frequency.value = drumConfig.freq * drumConfig.pitch;
            
            if (drumType === 'kick' || drumType === 'floor') {
                oscillator.type = 'sine';
                // Add pitch bend for kick
                oscillator.frequency.exponentialRampToValueAtTime(
                    drumConfig.freq * 0.5 * drumConfig.pitch, 
                    now + drumConfig.decay
                );
            } else if (drumType === 'snare' || drumType.includes('tom')) {
                oscillator.type = 'triangle';
            } else {
                oscillator.type = 'square';
            }

            // Connect oscillator
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            // Set volumes
            const toneVolume = volume * (drumConfig.tone || 1);
            gainNode.gain.setValueAtTime(toneVolume, now);
            gainNode.gain.exponentialRampToValueAtTime(0.01, now + drumConfig.decay);

            if (noiseGain && drumConfig.noise) {
                const noiseVolume = volume * drumConfig.noise * 0.3;
                noiseGain.gain.setValueAtTime(noiseVolume, now);
                noiseGain.gain.exponentialRampToValueAtTime(0.01, now + drumConfig.decay * 0.5);
                noiseNode.start(now);
                noiseNode.stop(now + drumConfig.decay * 0.5);
            }

            // Start and stop oscillator
            oscillator.start(now);
            oscillator.stop(now + drumConfig.decay);

            // Animate visualizer based on drum type
            const intensity = drumType === 'kick' || drumType === 'floor' ? 1 : 
                           drumType === 'crash' ? 0.8 : 0.6;
            animateVisualizer(intensity);
        }

        // Hit drum animation and sound
        function hitDrum(drumType, fromKeyboard = false) {
            initAudio();
            
            const drum = document.querySelector(`[data-drum="${drumType}"]`);
            if (drum) {
                drum.classList.add('active');
                setTimeout(() => drum.classList.remove('active'), 200);
            }

            // Animate drumsticks
            const stick = fromKeyboard ? 
                document.getElementById('leftStick') : 
                document.getElementById('rightStick');
            stick.classList.add('hitting');
            setTimeout(() => stick.classList.remove('hitting'), 200);

            playDrumSound(drumType);

            // Record if recording
            if (isRecording) {
                const timestamp = Date.now() - recordingStartTime;
                recordedBeats.push({ drum: drumType, time: timestamp });
            }
        }

        // Keyboard controls
        const keyMap = {
            ' ': 'kick',
            's': 'snare',
            'h': 'hihat',
            'c': 'crash',
            't': 'tom1',
            'y': 'tom2',
            'r': 'ride',
            'f': 'floor'
        };

        document.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            if (keyMap[key]) {
                e.preventDefault();
                hitDrum(keyMap[key], true);
            }
        });

        // Touch and mouse controls for drums
        document.querySelectorAll('.drum').forEach(drum => {
            const drumType = drum.getAttribute('data-drum');
            
            drum.addEventListener('mousedown', (e) => {
                e.preventDefault();
                hitDrum(drumType, false);
            });

            drum.addEventListener('touchstart', (e) => {
                e.preventDefault();
                hitDrum(drumType, false);
            });
        });

        // Recording controls
        document.getElementById('recordBtn').addEventListener('click', function() {
            if (!isRecording) {
                initAudio();
                isRecording = true;
                recordedBeats = [];
                recordingStartTime = Date.now();
                this.textContent = '‚èπÔ∏è Stop';
                this.classList.add('active');
                document.getElementById('recordingIndicator').classList.add('active');
                document.getElementById('playbackBtn').disabled = true;
            } else {
                isRecording = false;
                this.textContent = 'üî¥ Record';
                this.classList.remove('active');
                document.getElementById('recordingIndicator').classList.remove('active');
                document.getElementById('playbackBtn').disabled = recordedBeats.length === 0;
            }
        });

        // Playback recording
        document.getElementById('playbackBtn').addEventListener('click', function() {
            if (recordedBeats.length === 0) return;
            
            initAudio();
            this.disabled = true;
            
            // Clear any existing playback
            if (playbackTimeout) {
                clearTimeout(playbackTimeout);
            }

            // Play each recorded beat at its timestamp
            recordedBeats.forEach(beat => {
                playbackTimeout = setTimeout(() => {
                    hitDrum(beat.drum);
                }, beat.time);
            });

            // Re-enable button after playback
            const totalTime = recordedBeats[recordedBeats.length - 1].time;
            setTimeout(() => {
                document.getElementById('playbackBtn').disabled = false;
            }, totalTime + 500);
        });

        // Clear recording
        document.getElementById('clearBtn').addEventListener('click', () => {
            recordedBeats = [];
            document.getElementById('playbackBtn').disabled = true;
            if (playbackTimeout) {
                clearTimeout(playbackTimeout);
            }
        });

        // Volume controls
        document.querySelectorAll('.drum-volume').forEach(slider => {
            const drumType = slider.getAttribute('data-drum');
            slider.addEventListener('input', (e) => {
                drumVolumes[drumType] = e.target.value / 100;
            });
        });

        // Kit selection
        document.getElementById('kitSelect').addEventListener('change', (e) => {
            currentKit = e.target.value;
            initAudio();
        });

        // Pattern selection and playback
        document.getElementById('patternSelect').addEventListener('change', (e) => {
            const patternName = e.target.value;
            const patternBeats = document.getElementById('patternBeats');
            patternBeats.innerHTML = '';

            if (patternName !== 'none' && patterns[patternName]) {
                const pattern = patterns[patternName];
                pattern.beats.forEach((beat, index) => {
                    const indicator = document.createElement('div');
                    indicator.className = 'beat-indicator';
                    indicator.textContent = (index + 1);
                    patternBeats.appendChild(indicator);
                });
            }
        });

        document.getElementById('playPatternBtn').addEventListener('click', function() {
            const patternName = document.getElementById('patternSelect').value;
            if (patternName === 'none') return;

            initAudio();

            if (isPlayingPattern) {
                // Stop pattern
                isPlayingPattern = false;
                clearInterval(patternInterval);
                this.textContent = '‚ñ∂Ô∏è Play Pattern';
                document.querySelectorAll('.beat-indicator').forEach(b => {
                    b.classList.remove('active', 'current');
                });
            } else {
                // Start pattern
                isPlayingPattern = true;
                this.textContent = '‚èπÔ∏è Stop';
                currentPatternBeat = 0;

                const pattern = patterns[patternName];
                const beatDuration = 60000 / (pattern.tempo * 2); // 8th notes

                patternInterval = setInterval(() => {
                    const beats = pattern.beats[currentPatternBeat];
                    
                    // Update beat indicators
                    document.querySelectorAll('.beat-indicator').forEach((b, i) => {
                        b.classList.remove('current');
                        if (i === currentPatternBeat) {
                            b.classList.add('current');
                        }
                    });

                    // Play the drums for this beat
                    beats.forEach(drum => {
                        hitDrum(drum);
                    });

                    currentPatternBeat = (currentPatternBeat + 1) % pattern.beats.length;
                }, beatDuration);
            }
        });

        // Tempo control
        const tempoSlider = document.getElementById('tempoSlider');
        const tempoValue = document.getElementById('tempoValue');
        const metronomeLight = document.getElementById('metronomeLight');

        tempoSlider.addEventListener('input', (e) => {
            tempo = e.target.value;
            tempoValue.textContent = tempo + ' BPM';
            
            // Restart metronome if running
            if (metronomeInterval) {
                clearInterval(metronomeInterval);
                startMetronome();
            }
        });

        // Simple visual metronome
        function startMetronome() {
            const beatDuration = 60000 / tempo;
            metronomeInterval = setInterval(() => {
                metronomeLight.classList.add('active');
                setTimeout(() => {
                    metronomeLight.classList.remove('active');
                }, 100);
            }, beatDuration);
        }

        // Start metronome on load
        startMetronome();

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (metronomeInterval) clearInterval(metronomeInterval);
            if (patternInterval) clearInterval(patternInterval);
            if (playbackTimeout) clearTimeout(playbackTimeout);
        });
    </script>
</body>
</html>